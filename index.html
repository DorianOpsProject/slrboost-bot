<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <title>SLR BOOST | Catalogue</title>

  <!-- Telegram Mini App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      --bg:#0b0d12;
      --panel:#101522;
      --card:#0f1627;
      --stroke:rgba(255,255,255,.08);
      --text:#eaf0ff;
      --muted:rgba(234,240,255,.68);
      --accent:#ffd400;
      --accent2:#ffb800;
      --danger:#ff4d4d;
      --ok:#2ee59d;
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius:18px;
      --radius2:14px;
      --blur: 14px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      background:
        radial-gradient(1100px 600px at 20% -10%, rgba(255,212,0,.18), transparent 55%),
        radial-gradient(900px 500px at 90% 10%, rgba(255,184,0,.12), transparent 50%),
        radial-gradient(800px 450px at 50% 110%, rgba(120,180,255,.12), transparent 60%),
        var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    a{color:inherit}
    .wrap{
      max-width:1080px;
      margin:0 auto;
      padding: 18px 16px 110px;
    }

    /* Header */
    .topbar{
      position: sticky;
      top: 0;
      z-index: 40;
      padding: 10px 0 12px;
      backdrop-filter: blur(var(--blur));
      background: linear-gradient(to bottom, rgba(11,13,18,.85), rgba(11,13,18,.35), transparent);
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;
      display:grid;place-items:center;
      background: linear-gradient(135deg, rgba(255,212,0,.95), rgba(255,184,0,.85));
      color:#0b0d12;
      box-shadow: 0 10px 30px rgba(255,212,0,.15);
      font-weight:900;
      letter-spacing:.5px;
    }
    .title h1{
      margin:0;
      font-size: 18px;
      line-height: 1.05;
      letter-spacing: .2px;
    }
    .title p{
      margin:4px 0 0;
      color:var(--muted);
      font-size: 13px;
    }

    .gridHeader{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .controls{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    @media(min-width:780px){
      .gridHeader{
        grid-template-columns: 1.35fr .65fr;
        align-items: start;
      }
      .controls{
        grid-template-columns: 1fr 280px;
      }
    }

    .search{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 12px 14px;
      border:1px solid var(--stroke);
      background: rgba(16,21,34,.65);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .search input{
      width:100%;
      border:none;
      outline:none;
      background:transparent;
      color:var(--text);
      font-size: 14px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(16,21,34,.6);
      color: var(--muted);
      font-size: 13px;
      cursor:pointer;
      user-select:none;
      transition: .18s ease;
      white-space:nowrap;
    }
    .pill:hover{transform: translateY(-1px); color:var(--text)}
    .pill.active{
      color:#0b0d12;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-color: rgba(255,212,0,.55);
      box-shadow: 0 10px 30px rgba(255,212,0,.16);
    }

    .categories{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    /* Cards */
    .cards{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media(min-width:640px){
      .cards{grid-template-columns: 1fr 1fr}
    }
    @media(min-width:980px){
      .cards{grid-template-columns: 1fr 1fr 1fr}
    }

    .card{
      border-radius: var(--radius);
      border:1px solid var(--stroke);
      background: rgba(15,22,39,.72);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      transition: .18s ease;
    }
    .card:hover{transform: translateY(-2px)}
    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(500px 240px at 15% 0%, rgba(255,212,0,.12), transparent 60%);
      pointer-events:none;
    }
    .cardInner{
      position:relative;
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height: 210px;
    }

    .tagrow{
      display:flex; gap:8px; flex-wrap:wrap;
      align-items:center;
    }
    .tag{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(16,21,34,.55);
      color: var(--muted);
    }
    .tag.accent{
      color:#0b0d12;
      background: rgba(255,212,0,.92);
      border-color: rgba(255,212,0,.35);
      font-weight:700;
    }

    .card h3{
      margin:0;
      font-size: 16px;
      letter-spacing:.2px;
    }
    .desc{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
    }

    .meta{
      margin-top:auto;
      display:flex;
      gap:10px;
      align-items:flex-end;
      justify-content:space-between;
    }
    .ref{
      color: rgba(234,240,255,.85);
      font-size: 13px;
      padding: 8px 10px;
      border:1px dashed rgba(255,255,255,.16);
      border-radius: 12px;
      background: rgba(16,21,34,.35);
    }
    .price{
      font-weight: 900;
      font-size: 16px;
      letter-spacing: .2px;
    }
    .price small{
      color:var(--muted);
      font-weight:600;
      font-size: 12px;
      margin-left: 6px;
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top: 10px;
    }
    .btn{
      border:none;
      outline:none;
      cursor:pointer;
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 800;
      font-size: 14px;
      transition: .18s ease;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      user-select:none;
    }
    .btn:active{transform: scale(.99)}
    .btn.secondary{
      background: rgba(16,21,34,.65);
      border:1px solid var(--stroke);
      color: var(--text);
      flex: 1;
    }
    .btn.primary{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color:#0b0d12;
      flex: 1;
      box-shadow: 0 16px 40px rgba(255,212,0,.14);
    }
    .btn.danger{
      background: rgba(255,77,77,.12);
      border:1px solid rgba(255,77,77,.25);
      color: rgba(255,200,200,.95);
    }

    /* Drawer Cart */
    .drawerOverlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(8px);
      display:none;
      z-index: 60;
    }
    .drawer{
      position:fixed;
      right:0; top:0; bottom:0;
      width:min(420px, 94vw);
      background: rgba(10,12,16,.92);
      border-left: 1px solid var(--stroke);
      box-shadow: -20px 0 60px rgba(0,0,0,.55);
      transform: translateX(105%);
      transition: .22s ease;
      z-index: 61;
      display:flex;
      flex-direction:column;
    }
    .drawerHeader{
      padding: 14px 14px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px solid var(--stroke);
    }
    .drawerHeader h2{
      margin:0;
      font-size: 16px;
      letter-spacing:.2px;
    }
    .drawerBody{
      padding: 12px 14px;
      overflow:auto;
      flex:1;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .line{
      border:1px solid var(--stroke);
      border-radius: 16px;
      background: rgba(16,21,34,.6);
      padding: 12px;
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items:center;
    }
    .lineTitle{
      font-weight: 800;
      font-size: 14px;
      margin:0;
    }
    .lineSub{
      margin:4px 0 0;
      color:var(--muted);
      font-size: 12px;
    }
    .qty{
      display:flex; align-items:center; gap:8px;
    }
    .qty button{
      width:34px; height:34px;
      border-radius: 12px;
      border:1px solid var(--stroke);
      background: rgba(10,12,16,.35);
      color: var(--text);
      cursor:pointer;
      font-weight:900;
    }
    .qty span{
      width: 26px;
      text-align:center;
      font-weight:900;
    }

    .drawerFooter{
      border-top: 1px solid var(--stroke);
      padding: 12px 14px 16px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .totals{
      display:flex;
      align-items:center;
      justify-content:space-between;
      color:var(--muted);
      font-size: 13px;
    }
    .totals strong{
      color:var(--text);
      font-size: 16px;
    }

    /* Bottom bar */
    .bottombar{
      position: fixed;
      left:0; right:0; bottom:0;
      z-index: 50;
      padding: 12px 14px 16px;
      backdrop-filter: blur(var(--blur));
      background: linear-gradient(to top, rgba(11,13,18,.92), rgba(11,13,18,.55), transparent);
    }
    .barInner{
      max-width:1080px;
      margin:0 auto;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .cartBtn{
      flex: 1;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px 14px;
      border-radius: 18px;
      border:1px solid var(--stroke);
      background: rgba(16,21,34,.65);
      box-shadow: var(--shadow);
      cursor:pointer;
      user-select:none;
    }
    .cartLeft{
      display:flex; flex-direction:column; gap:2px;
    }
    .cartLeft .t1{font-weight:900; letter-spacing:.2px}
    .cartLeft .t2{color:var(--muted); font-size: 12px}
    .badge{
      min-width: 34px;
      height: 34px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      font-weight: 900;
      color:#0b0d12;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border: 1px solid rgba(255,212,0,.35);
    }

    .note{
      margin-top: 14px;
      border: 1px solid rgba(255,212,0,.18);
      background: rgba(255,212,0,.06);
      border-radius: var(--radius);
      padding: 12px 14px;
      color: rgba(234,240,255,.82);
      font-size: 13px;
      line-height: 1.45;
    }

    .sr-only{
      position:absolute;
      width:1px;height:1px;
      padding:0;margin:-1px;
      overflow:hidden;clip:rect(0,0,0,0);
      white-space:nowrap;border:0;
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="wrap">
      <div class="brand">
        <div class="logo">‚ö°</div>
        <div class="title">
          <h1>SLR BOOST</h1>
          <p>Catalogue ‚Ä¢ Que de la frappe ‚Ä¢ Commande via Telegram</p>
        </div>
      </div>

      <div class="gridHeader">
        <div class="controls" aria-label="Contr√¥les catalogue">
          <label class="search" aria-label="Recherche">
            <span aria-hidden="true">üîé</span>
            <input id="q" type="search" placeholder="Rechercher un produit, une r√©f√©rence, un tag‚Ä¶" autocomplete="off" />
          </label>

          <button id="clear" class="pill" type="button" title="R√©initialiser filtres">
            ‚ôªÔ∏è R√©initialiser
          </button>
        </div>

        <div class="categories" id="cats" aria-label="Cat√©gories"></div>
      </div>

      <div class="note">
        ‚úÖ S√©lectionne ta frappe ‚Üí ajoute la au panier ‚Üí <strong>Commander</strong> ouvre un message Telegram pr√©-rempli avec les r√©f√©rences et quantit√©s.
      </div>
    </div>
  </div>

  <main class="wrap">
    <section class="cards" id="list" aria-label="Liste des produits"></section>
  </main>

  <!-- Bottom cart bar -->
  <div class="bottombar">
    <div class="barInner">
      <div class="cartBtn" id="openCart" role="button" tabindex="0" aria-label="Ouvrir le panier">
        <div class="cartLeft">
          <div class="t1">üõí Panier</div>
          <div class="t2" id="cartHint">Aucun article</div>
        </div>
        <div class="badge" id="cartCount">0</div>
      </div>
    </div>
  </div>

  <!-- Drawer -->
  <div class="drawerOverlay" id="overlay" aria-hidden="true"></div>
  <aside class="drawer" id="drawer" aria-label="Panier">
    <div class="drawerHeader">
      <h2>üßæ Ta commande</h2>
      <button class="btn secondary" id="closeCart" type="button">Fermer</button>
    </div>

    <div class="drawerBody" id="cartLines">
      <!-- lines -->
    </div>

    <div class="drawerFooter">
      <div class="totals">
        <span>Total estim√©</span>
        <strong id="total">0 ‚Ç¨</strong>
      </div>

      <button class="btn primary" id="orderBtn" type="button">
        ‚úÖ Commander sur Telegram
      </button>

      <button class="btn danger" id="emptyBtn" type="button">
        üóëÔ∏è Vider le panier
      </button>

      <div class="totals" style="margin-top:2px">
        <span style="color:var(--muted)">Conseil</span>
        <span style="color:var(--muted)">Ajoute une note (ex : retrait / livraison / cr√©neau)</span>
      </div>
      <label class="search" style="box-shadow:none; border-radius:16px">
        <span aria-hidden="true">üí¨</span>
        <input id="note" type="text" placeholder="Message (optionnel)" maxlength="160" />
      </label>
    </div>
  </aside>

  <script>
    /**
     * ‚úÖ CONFIG
     * Remplace par ton @ (sans @). Exemple: "Petter59000XSLR"
     */
    const TELEGRAM_USERNAME = "Petter59000XSLR";

    /**
     * ‚úÖ DATA PRODUITS (l√©gaux)
     * Ajoute autant de cat√©gories/produits que tu veux.
     */
    const PRODUCTS = [
  {
    id: "SLR-P01",
    name: "Produit 01",
    category: "Catalogue",
    origin: "üá≤üá¶ Maroc",
    quality: "Premium",
    price: 0.00,
    desc: "Description (exemple).",
    tags: ["Nouveau"]
  },
  {
    id: "SLR-P02",
    name: "Produit 02",
    category: "Catalogue",
    origin: "üá≤üá¶ Maroc",
    quality: "Premium",
    price: 0.00,
    desc: "Description (exemple).",
    tags: ["Populaire"]
  },
  {
    id: "SLR-P03",
    name: "Produit 03",
    category: "Catalogue",
    origin: "üá≤üá¶ Maroc",
    quality: "Premium",
    price: 0.00,
    desc: "Description (exemple).",
    tags: ["Stock limit√©"]
  },
  {
    id: "SLR-P04",
    name: "Produit 04",
    category: "Catalogue",
    origin: "üá≤üá¶ Maroc",
    quality: "Premium",
    price: 0.00,
    desc: "Description (exemple).",
    tags: []
  },
  {
    id: "SLR-P05",
    name: "Produit 05",
    category: "Catalogue",
    origin: "üá≥üá± Pays-Bas",
    quality: "Premium",
    price: 0.00,
    desc: "Description (exemple).",
    tags: ["Best-seller"]
  },
  {
    id: "SLR-P06",
    name: "Produit 06",
    category: "Catalogue",
    origin: "üá≥üá± Pays-Bas",
    quality: "Premium",
    price: 0.00,
    desc: "Description (exemple).",
    tags: []
  },
  {
    id: "SLR-P07",
    name: "Produit 07",
    category: "Catalogue",
    origin: "üá∫üá∏ USA",
    quality: "Premium",
    price: 0.00,
    desc: "Description (exemple).",
    tags: ["USA"]
  },
  {
    id: "SLR-P08",
    name: "Produit 08",
    category: "Catalogue",
    origin: "üá≥üá± Pays-Bas",
    quality: "Premium",
    price: 0.00,
    desc: "Description (exemple).",
    tags: []
  },
  {
    id: "SLR-P09",
    name: "Produit 09",
    category: "Catalogue",
    origin: "üá∫üá∏ USA",
    quality: "Premium",
    price: 0.00,
    desc: "Description (exemple).",
    tags: []
  },
  {
    id: "SLR-P10",
    name: "Produit 10",
    category: "Catalogue",
    origin: "üá∫üá∏ USA",
    quality: "Premium",
    price: 0.00,
    desc: "Description (exemple).",
    tags: []
  },
  {
    id: "SLR-P11",
    name: "Produit 11",
    category: "Catalogue",
    origin: "üá®üá¶ Canada",
    quality: "Premium",
    price: 0.00,
    desc: "Description (exemple).",
    tags: ["Canada"]
  }
];;

    // Telegram init
    const tg = window.Telegram?.WebApp;
    if (tg) {
      tg.ready();
      tg.expand();
      // Optionnel: match theme
      document.documentElement.style.colorScheme = "dark";
    }

    // State
    const state = {
      query: "",
      category: "Tout",
      cart: loadCart() // {id: qty}
    };

    // Elements
    const listEl = document.getElementById("list");
    const catsEl = document.getElementById("cats");
    const qEl = document.getElementById("q");
    const clearEl = document.getElementById("clear");

    const openCartEl = document.getElementById("openCart");
    const overlayEl = document.getElementById("overlay");
    const drawerEl = document.getElementById("drawer");
    const closeCartEl = document.getElementById("closeCart");

    const cartLinesEl = document.getElementById("cartLines");
    const cartCountEl = document.getElementById("cartCount");
    const cartHintEl = document.getElementById("cartHint");
    const totalEl = document.getElementById("total");

    const orderBtnEl = document.getElementById("orderBtn");
    const emptyBtnEl = document.getElementById("emptyBtn");
    const noteEl = document.getElementById("note");

    // Helpers
    function money(n){
      return (Math.round(n * 100) / 100).toFixed(2).replace(".", ",") + " ‚Ç¨";
    }

    function uniqueCategories(){
      const set = new Set(PRODUCTS.map(p => p.category));
      return ["Tout", ...Array.from(set)];
    }

    function normalize(s){
      return (s || "").toString().toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu, "");
    }

    function saveCart(){
      localStorage.setItem("slr_cart", JSON.stringify(state.cart));
    }
    function loadCart(){
      try{
        const raw = localStorage.getItem("slr_cart");
        return raw ? JSON.parse(raw) : {};
      }catch(e){
        return {};
      }
    }

    function cartCount(){
      return Object.values(state.cart).reduce((a,b)=>a + b, 0);
    }

    function cartTotal(){
      let total = 0;
      for (const [id, qty] of Object.entries(state.cart)){
        const p = PRODUCTS.find(x => x.id === id);
        if (p) total += p.price * qty;
      }
      return total;
    }

    function addToCart(id, qty=1){
      state.cart[id] = (state.cart[id] || 0) + qty;
      if (state.cart[id] <= 0) delete state.cart[id];
      saveCart();
      renderCartBadge();
    }

    function setQty(id, qty){
      if (qty <= 0) delete state.cart[id];
      else state.cart[id] = qty;
      saveCart();
      renderCartBadge();
      renderCartDrawer();
    }

    function clearCart(){
      state.cart = {};
      saveCart();
      renderCartBadge();
      renderCartDrawer();
    }

    function filteredProducts(){
      const q = normalize(state.query);
      return PRODUCTS.filter(p => {
        const inCat = state.category === "Tout" || p.category === state.category;
        if (!inCat) return false;

        if (!q) return true;

        const blob = normalize([
          p.name, p.id, p.category, p.origin, p.quality, p.desc, ...(p.tags || [])
        ].join(" "));

        return blob.includes(q);
      });
    }

    // Render categories
    function renderCategories(){
      const cats = uniqueCategories();
      catsEl.innerHTML = "";
      cats.forEach(cat => {
        const b = document.createElement("button");
        b.type = "button";
        b.className = "pill" + (state.category === cat ? " active" : "");
        b.textContent = cat;
        b.addEventListener("click", () => {
          state.category = cat;
          renderCategories();
          renderList();
        });
        catsEl.appendChild(b);
      });
    }

    // Render product list
    function renderList(){
      const items = filteredProducts();
      listEl.innerHTML = "";

      if (!items.length){
        const empty = document.createElement("div");
        empty.className = "note";
        empty.textContent = "Aucun produit ne correspond √† ta recherche.";
        listEl.appendChild(empty);
        return;
      }

      items.forEach(p => {
        const card = document.createElement("article");
        card.className = "card";
        card.innerHTML = `
          <div class="cardInner">
            <div class="tagrow">
              <span class="tag accent">${p.category}</span>
              ${(p.tags || []).slice(0,2).map(t => `<span class="tag">${escapeHtml(t)}</span>`).join("")}
            </div>

            <h3>${escapeHtml(p.name)}</h3>
            <p class="desc">
              Provenance : ${escapeHtml(p.origin)}<br>
              Type : ${escapeHtml(p.quality)}<br>
              <span style="opacity:.9">${escapeHtml(p.desc)}</span>
            </p>

            <div class="meta">
              <div class="ref">R√©f : <strong>${escapeHtml(p.id)}</strong></div>
              <div class="price">${money(p.price)} <small>/ unit√©</small></div>
            </div>

            <div class="actions">
              <button class="btn secondary" type="button" data-copy="${p.id}">üìã Copier la r√©f</button>
              <button class="btn primary" type="button" data-add="${p.id}">‚ûï Ajouter</button>
            </div>
          </div>
        `;

        // Copy ref
        card.querySelector(`[data-copy="${p.id}"]`).addEventListener("click", async () => {
          try{
            await navigator.clipboard.writeText(p.id);
            toast("R√©f√©rence copi√©e : " + p.id);
          }catch{
            toast("Copie impossible sur ce device.");
          }
        });

        // Add to cart
        card.querySelector(`[data-add="${p.id}"]`).addEventListener("click", () => {
          addToCart(p.id, 1);
          toast("Ajout√© au panier : " + p.id);
          // Option: open cart quickly
          // openCart();
        });

        listEl.appendChild(card);
      });
    }

    // Render cart badge
    function renderCartBadge(){
      const c = cartCount();
      cartCountEl.textContent = String(c);
      cartHintEl.textContent = c ? `${c} article(s) ‚Ä¢ ${money(cartTotal())}` : "Aucun article";
      if (tg) {
        // MainButton in Telegram (optional)
        tg.MainButton.setText(c ? `Commander (${c})` : "Panier vide");
        tg.MainButton.color = "#ffd400";
        tg.MainButton.textColor = "#0b0d12";
        if (c) tg.MainButton.show(); else tg.MainButton.hide();
      }
    }

    // Drawer open/close
    function openCart(){
      overlayEl.style.display = "block";
      drawerEl.style.transform = "translateX(0)";
      overlayEl.setAttribute("aria-hidden","false");
      renderCartDrawer();
    }
    function closeCart(){
      overlayEl.style.display = "none";
      drawerEl.style.transform = "translateX(105%)";
      overlayEl.setAttribute("aria-hidden","true");
    }

    // Render cart drawer
    function renderCartDrawer(){
      cartLinesEl.innerHTML = "";
      const entries = Object.entries(state.cart);

      if (!entries.length){
        const empty = document.createElement("div");
        empty.className = "note";
        empty.textContent = "Ton panier est vide. Ajoute des produits pour commander.";
        cartLinesEl.appendChild(empty);
        totalEl.textContent = money(0);
        return;
      }

      entries.forEach(([id, qty]) => {
        const p = PRODUCTS.find(x => x.id === id);
        if (!p) return;

        const line = document.createElement("div");
        line.className = "line";
        line.innerHTML = `
          <div>
            <p class="lineTitle">${escapeHtml(p.name)}</p>
            <p class="lineSub">R√©f: <strong>${escapeHtml(p.id)}</strong> ‚Ä¢ ${money(p.price)} / unit√©</p>
          </div>
          <div class="qty" aria-label="Quantit√©">
            <button type="button" data-dec="${id}" aria-label="Diminuer">‚àí</button>
            <span>${qty}</span>
            <button type="button" data-inc="${id}" aria-label="Augmenter">+</button>
          </div>
        `;

        line.querySelector(`[data-dec="${id}"]`).addEventListener("click", () => setQty(id, (state.cart[id]||0) - 1));
        line.querySelector(`[data-inc="${id}"]`).addEventListener("click", () => setQty(id, (state.cart[id]||0) + 1));

        cartLinesEl.appendChild(line);
      });

      totalEl.textContent = money(cartTotal());
    }

    // Order message builder
    function buildOrderText(){
      const entries = Object.entries(state.cart);
      const lines = [];
      lines.push("üì¶ Ma Commande SLR BOOST");
      lines.push("");
      lines.push("üßæ Articles :");

      entries.forEach(([id, qty]) => {
        const p = PRODUCTS.find(x => x.id === id);
        if (!p) return;
        lines.push(`‚Ä¢ ${p.name} ‚Äî ${id} ‚Äî x${qty}`);
      });

      lines.push("");
      lines.push(`üí∞ Total estim√© : ${money(cartTotal())}`);
      lines.push("");
      lines.push("üìç Zone : (√† pr√©ciser)");
      lines.push("üì¶ Livraison ou sur place : (√† pr√©ciser)");
      const note = (noteEl.value || "").trim();
      lines.push(`üí¨ Message : ${note ? note : ""}`);

      // Optionnel: infos Telegram user
      if (tg?.initDataUnsafe?.user) {
        const u = tg.initDataUnsafe.user;
        const who = [u.first_name, u.last_name].filter(Boolean).join(" ").trim();
        lines.push("");
        lines.push(`üë§ Client : ${who || ""} ${u.username ? "(@" + u.username + ")" : ""}`.trim());
      }

      return lines.join("\n");
    }

    function openTelegramPrefilledMessage(text){
      const encoded = encodeURIComponent(text);

      // 1) Mini App: openTelegramLink is the safest
      if (tg?.openTelegramLink){
        tg.openTelegramLink(`https://t.me/${TELEGRAM_USERNAME}?text=${encoded}`);
        return;
      }

      // 2) Browser fallback
      window.location.href = `https://t.me/${TELEGRAM_USERNAME}?text=${encoded}`;
    }

    // Toast
    let toastT = null;
    function toast(msg){
      clearTimeout(toastT);
      let el = document.getElementById("toast");
      if (!el){
        el = document.createElement("div");
        el.id = "toast";
        el.style.position = "fixed";
        el.style.left = "50%";
        el.style.bottom = "90px";
        el.style.transform = "translateX(-50%)";
        el.style.padding = "10px 12px";
        el.style.borderRadius = "14px";
        el.style.border = "1px solid rgba(255,255,255,.12)";
        el.style.background = "rgba(16,21,34,.88)";
        el.style.backdropFilter = "blur(12px)";
        el.style.color = "rgba(234,240,255,.92)";
        el.style.fontWeight = "700";
        el.style.fontSize = "13px";
        el.style.zIndex = "999";
        el.style.boxShadow = "0 14px 40px rgba(0,0,0,.45)";
        document.body.appendChild(el);
      }
      el.textContent = msg;
      el.style.opacity = "1";
      toastT = setTimeout(()=> el.style.opacity = "0", 1400);
    }

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, s => ({
        "&":"&amp;",
        "<":"&lt;",
        ">":"&gt;",
        '"':"&quot;",
        "'":"&#039;"
      }[s]));
    }

    // Events
    qEl.addEventListener("input", (e) => {
      state.query = e.target.value;
      renderList();
    });

    clearEl.addEventListener("click", () => {
      state.query = "";
      state.category = "Tout";
      qEl.value = "";
      noteEl.value = "";
      renderCategories();
      renderList();
      toast("Filtres r√©initialis√©s");
    });

    openCartEl.addEventListener("click", openCart);
    openCartEl.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); openCart(); } });

    overlayEl.addEventListener("click", closeCart);
    closeCartEl.addEventListener("click", closeCart);

    emptyBtnEl.addEventListener("click", () => {
      clearCart();
      toast("Panier vid√©");
    });

    orderBtnEl.addEventListener("click", () => {
      if (!cartCount()){
        toast("Panier vide");
        return;
      }
      const text = buildOrderText();
      openTelegramPrefilledMessage(text);
    });

    // Telegram MainButton (optional)
    if (tg){
      tg.MainButton.onClick(() => {
        if (!cartCount()) return;
        openTelegramPrefilledMessage(buildOrderText());
      });
    }

    // Init
    renderCategories();
    renderList();
    renderCartBadge();
    renderCartDrawer();
  </script>
</body>
</html>
